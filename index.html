<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>æ¼«å¤©çƒŸèŠ±ç§€ ğŸ†</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            overflow: hidden;
            background: linear-gradient(to bottom, #0a0a1a 0%, #1a1a2e 50%, #16213e 100%);
            font-family: 'Arial', sans-serif;
        }

        canvas {
            display: block;
            /* è‡ªå®šä¹‰çˆ±å¿ƒé¼ æ ‡ */
            cursor: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 32 32"><text y="24" font-size="24">ğŸ’•</text></svg>') 16 16,
                    pointer;
        }

        /* ç‚¹å‡»æ—¶çš„å…‰æ ‡æ•ˆæœ */
        canvas:active {
            cursor: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 32 32"><text y="24" font-size="24">ğŸ’–</text></svg>') 16 16,
                    pointer;
        }

        /* æç¤ºæ–‡å­— */
        .hint {
            position: fixed;
            bottom: 56px;
            left: 50%;
            transform: translateX(-50%);
            color: rgba(255, 255, 255, 0.6);
            font-size: 14px;
            text-align: center;
            pointer-events: none;
            animation: pulse 2s ease-in-out infinite;
            width: 100%;
        }

        /* ä¸­é—´å¤§æ–‡å­— - æ¸©é¦¨ç¯ç‰Œæ•ˆæœ */
        .centerText {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            color: #FFF8DC; /* æš–ç™½è‰² */
            font-size: 92px;
            font-weight: bold;
            text-align: center;
            pointer-events: none;
            /* æ¸©æš–çš„ç¯ç‰Œå…‰æ™• */
            text-shadow:
                0 0 10px rgba(255, 200, 100, 0.8),
                0 0 20px rgba(255, 180, 80, 0.6),
                0 0 30px rgba(255, 160, 60, 0.5),
                0 0 40px rgba(255, 140, 40, 0.4),
                0 0 80px rgba(255, 120, 20, 0.3),
                0 0 120px rgba(255, 100, 0, 0.2);
            animation: warmGlow 2s ease-in-out infinite alternate;
        }

        @keyframes pulse {
            0%, 100% { opacity: 0.4; }
            50% { opacity: 0.8; }
        }

        @keyframes warmGlow {
            0% {
                color: #FFF8DC;
                text-shadow:
                    0 0 10px rgba(255, 200, 100, 0.8),
                    0 0 20px rgba(255, 180, 80, 0.6),
                    0 0 30px rgba(255, 160, 60, 0.5),
                    0 0 40px rgba(255, 140, 40, 0.4),
                    0 0 80px rgba(255, 120, 20, 0.3),
                    0 0 120px rgba(255, 100, 0, 0.2);
            }
            100% {
                color: #FFE4B5;
                text-shadow:
                    0 0 15px rgba(255, 220, 120, 0.9),
                    0 0 30px rgba(255, 200, 100, 0.7),
                    0 0 45px rgba(255, 180, 80, 0.6),
                    0 0 60px rgba(255, 160, 60, 0.5),
                    0 0 100px rgba(255, 140, 40, 0.4),
                    0 0 150px rgba(255, 120, 20, 0.3);
            }
        }

        /* çƒŸèŠ±ç±»å‹é€‰æ‹©å™¨ */
        .fireworkSelector {
            position: fixed;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            display: flex;
            gap: 8px;
            pointer-events: auto;
            flex-wrap: wrap;
            justify-content: center;
            width: 100%;
        }

        .fireworkType {
            color: rgba(255, 255, 255, 0.5);
            font-size: 12px;
            cursor: pointer;
            padding: 4px 10px;
            border-radius: 12px;
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            transition: all 0.3s ease;
        }

        .fireworkType:hover {
            color: rgba(255, 255, 255, 0.8);
            background: rgba(255, 255, 255, 0.1);
            border-color: rgba(255, 255, 255, 0.3);
        }

        .fireworkType.active {
            color: rgba(255, 220, 150, 1);
            background: rgba(255, 200, 100, 0.2);
            border-color: rgba(255, 200, 100, 0.5);
            box-shadow: 0 0 10px rgba(255, 200, 100, 0.3);
        }

        /* ç§»åŠ¨ç«¯ä¼˜åŒ– */
        @media (max-width: 768px) {
            .hint {
                bottom: 50px;
                font-size: 12px;
                width: 100%;
            }

            .centerText {
                font-size: 36px;
                padding: 0 20px;
            }

            .fireworkSelector {
                bottom: 15px;
                gap: 6px;
                width: 100%;
            }

            .fireworkType {
                font-size: 11px;
                padding: 3px 8px;
            }

            /* æ¨ªå±æ¨¡å¼ */
            @media (orientation: landscape) {
                .hint {
                    bottom: 40px;
                    font-size: 11px;
                    width: 100%;
                }

                .fireworkSelector {
                    bottom: 15px;
                    gap: 5px;
                    width: 100%;
                }

                .fireworkType {
                    font-size: 10px;
                    padding: 2px 6px;
                }
            }
        }

        /* è¶…å°å±å¹•ï¼ˆæ‰‹æœºç«–å±ï¼‰ */
        @media (max-width: 480px) {
            .hint {
                bottom: 50px;
                font-size: 11px;
                width: 100%;
            }

            .centerText {
                font-size: 28px;
                padding: 0 15px;
            }

            .fireworkSelector {
                bottom: 15px;
                gap: 4px;
                width: 100%;
            }

            .fireworkType {
                font-size: 10px;
                padding: 2px 6px;
            }
        }
    </style>
</head>
<body>
    <!-- Canvas ç”»å¸ƒ -->
    <canvas id="fireworksCanvas"></canvas>

    <!-- åº•éƒ¨æç¤º -->
    <div class="hint">âœ¨ å•å‡»å‘å°„çƒŸèŠ± Â· ä¸‰è¿å‡»åˆ‡æ¢å…¨å± âœ¨</div>

    <!-- çƒŸèŠ±ç±»å‹é€‰æ‹©å™¨ -->
    <div class="fireworkSelector" id="fireworkSelector"></div>

    <!-- ä¸­é—´æ–‡å­—å®¹å™¨ï¼ˆåŠ¨æ€ç”Ÿæˆï¼‰ -->
    <div id="centerTextContainer"></div>

    <script>
        /**
         * çƒŸèŠ±æ•ˆæœä¸»ç¨‹åº
         * å®ç°æ€è·¯ï¼š
         * 1. ä½¿ç”¨ Canvas 2D è¿›è¡Œé«˜æ€§èƒ½ç²’å­æ¸²æŸ“
         * 2. ç²’å­ç³»ç»Ÿï¼šçƒŸèŠ±å‡ç©º â†’ çˆ†ç‚¸ â†’ ç²’å­æ‰©æ•£ â†’ æ¸éš
         * 3. ç‰©ç†æ¨¡æ‹Ÿï¼šé‡åŠ›ã€ç©ºæ°”é˜»åŠ›ã€é€Ÿåº¦è¡°å‡
         * 4. è§†è§‰æ•ˆæœï¼šæ‹–å°¾ã€é¢œè‰²éšæœºã€é€æ˜åº¦æ¸å˜
         */

        const canvas = document.getElementById('fireworksCanvas');
        const ctx = canvas.getContext('2d');

        // ç”»å¸ƒå°ºå¯¸è®¾ç½®
        let canvasWidth = window.innerWidth;
        let canvasHeight = window.innerHeight;

        function resizeCanvas() {
            canvasWidth = window.innerWidth;
            canvasHeight = window.innerHeight;
            canvas.width = canvasWidth;
            canvas.height = canvasHeight;
        }
        resizeCanvas();
        window.addEventListener('resize', resizeCanvas);

        // ===== éŸ³æ•ˆç³»ç»Ÿ =====

        /**
         * éŸ³æ•ˆç®¡ç†å™¨
         * ä½¿ç”¨ Web Audio API ç”ŸæˆçƒŸèŠ±çˆ†ç‚¸éŸ³æ•ˆ
         */
        class SoundManager {
            constructor() {
                this.audioContext = null;
                this.enabled = true;
            }

            // åˆå§‹åŒ–éŸ³é¢‘ä¸Šä¸‹æ–‡ï¼ˆéœ€è¦ç”¨æˆ·äº¤äº’åæ‰èƒ½å¯åŠ¨ï¼‰
            init() {
                if (!this.audioContext) {
                    this.audioContext = new (window.AudioContext || window.webkitAudioContext)();
                }
                if (this.audioContext.state === 'suspended') {
                    this.audioContext.resume();
                }
            }

            /**
             * æ’­æ”¾çˆ†ç‚¸éŸ³æ•ˆ
             * @param {number} volume - éŸ³é‡ (0-1)
             */
            playExplosion(volume = 0.2) {
                if (!this.enabled || !this.audioContext) return;

                const now = this.audioContext.currentTime;

                // åˆ›å»ºç™½å™ªéŸ³ï¼ˆçˆ†ç‚¸å£°åŸºç¡€ï¼‰
                const bufferSize = this.audioContext.sampleRate * 0.8; // 0.8ç§’
                const buffer = this.audioContext.createBuffer(1, bufferSize, this.audioContext.sampleRate);
                const data = buffer.getChannelData(0);

                for (let i = 0; i < bufferSize; i++) {
                    data[i] = Math.random() * 2 - 1;
                }

                const noise = this.audioContext.createBufferSource();
                noise.buffer = buffer;

                // ä½é€šæ»¤æ³¢å™¨ï¼ˆè®©å£°éŸ³æ›´æ²‰é—·ï¼Œåƒè¿œå¤„çš„çˆ†ç‚¸ï¼‰
                const filter = this.audioContext.createBiquadFilter();
                filter.type = 'lowpass';
                filter.frequency.setValueAtTime(2000, now); // åˆå§‹é¢‘ç‡æ›´é«˜ï¼Œæ›´æ¸…è„†
                filter.frequency.exponentialRampToValueAtTime(100, now + 0.6); // å¿«é€Ÿé™åˆ°ä½é¢‘

                // éŸ³é‡åŒ…ç»œï¼ˆçˆ†ç‚¸æ—¶çªç„¶å¢å¤§ï¼Œç„¶åå¿«é€Ÿè¡°å‡ï¼‰
                const gainNode = this.audioContext.createGain();
                gainNode.gain.setValueAtTime(0, now); // ä»é™éŸ³å¼€å§‹
                gainNode.gain.linearRampToValueAtTime(volume, now + 0.02); // 2mså†…è¿…é€Ÿè¾¾åˆ°æœ€å¤§éŸ³é‡
                gainNode.gain.exponentialRampToValueAtTime(0.01, now + 0.6); // ç„¶åå¿«é€Ÿè¡°å‡

                noise.connect(filter);
                filter.connect(gainNode);
                gainNode.connect(this.audioContext.destination);

                noise.start(now);
                noise.stop(now + 0.6);
            }
        }

        // åˆ›å»ºéŸ³æ•ˆç®¡ç†å™¨
        const soundManager = new SoundManager();

        // ===== URLå‚æ•°æ–‡å­—æ˜¾ç¤º =====

        /**
         * ä»URLè·å–textå‚æ•°å¹¶æ˜¾ç¤ºåœ¨é¡µé¢ä¸­é—´
         * ä¾‹å¦‚: fireworks.html?text=æ–°å¹´å¿«ä¹
         */
        function initCenterText() {
            const urlParams = new URLSearchParams(window.location.search);
            const text = urlParams.get('text');

            if (text) {
                // è§£ç URLç¼–ç çš„æ–‡å­—
                const decodedText = decodeURIComponent(text);

                // åˆ›å»ºæ–‡å­—å…ƒç´ 
                const textElement = document.createElement('div');
                textElement.className = 'centerText';
                textElement.textContent = decodedText;

                // æ·»åŠ åˆ°å®¹å™¨
                document.getElementById('centerTextContainer').appendChild(textElement);
            }
        }

        // åˆå§‹åŒ–æ–‡å­—æ˜¾ç¤º
        initCenterText();

        // ===== çƒŸèŠ±ç±»å‹é€‰æ‹©å™¨ =====

        /**
         * çƒŸèŠ±ç±»å‹åç§°æ˜ å°„
         */
        const fireworkTypeNames = {
            'sphere': 'åœ†å½¢',
            'heart': 'çˆ±å¿ƒ',
            'star': 'æ˜Ÿæ˜Ÿ',
            'ring': 'åœ†ç¯',
            'spiral': 'èºæ—‹',
            'willow': 'å‚æŸ³',
            'chrysanthemum': 'èŠèŠ±',
            'all': 'å…¨éƒ¨'
        };

        /**
         * å½“å‰é€‰ä¸­çš„çƒŸèŠ±ç±»å‹
         * é»˜è®¤ 'sphere'ï¼Œ'all' è¡¨ç¤ºéšæœºä½¿ç”¨æ‰€æœ‰ç±»å‹
         */
        let currentFireworkType = 'sphere';

        /**
         * åˆå§‹åŒ–çƒŸèŠ±ç±»å‹é€‰æ‹©å™¨
         */
        function initFireworkSelector() {
            const selector = document.getElementById('fireworkSelector');
            const types = ['sphere', 'heart', 'star', 'ring', 'spiral', 'willow', 'chrysanthemum', 'all'];

            types.forEach(type => {
                const button = document.createElement('div');
                button.className = 'fireworkType';
                button.textContent = fireworkTypeNames[type];
                button.dataset.type = type;

                // é»˜è®¤é€‰ä¸­åœ†å½¢
                if (type === 'sphere') {
                    button.classList.add('active');
                }

                // ç‚¹å‡»åˆ‡æ¢ç±»å‹
                button.addEventListener('click', () => {
                    // ç§»é™¤æ‰€æœ‰active
                    document.querySelectorAll('.fireworkType').forEach(btn => {
                        btn.classList.remove('active');
                    });

                    // æ·»åŠ activeåˆ°å½“å‰æŒ‰é’®
                    button.classList.add('active');

                    // æ›´æ–°å½“å‰ç±»å‹
                    currentFireworkType = type;
                });

                selector.appendChild(button);
            });
        }

        // åˆå§‹åŒ–é€‰æ‹©å™¨
        initFireworkSelector();

        // é¦–æ¬¡ç”¨æˆ·äº¤äº’æ—¶åˆå§‹åŒ–éŸ³é¢‘
        document.addEventListener('click', () => soundManager.init(), { once: true });
        document.addEventListener('touchstart', () => soundManager.init(), { once: true });

        // ===== çƒŸèŠ±ç±»å‹ç³»ç»Ÿ =====

        /**
         * çƒŸèŠ±ç±»å‹æšä¸¾
         */
        const FireworkTypes = {     
            SPHERE: 'sphere',           // åœ†å½¢çˆ†ç‚¸ï¼ˆé»˜è®¤ï¼‰
            HEART: 'heart',             // å¿ƒå½¢
            STAR: 'star',               // æ˜Ÿå½¢
            RING: 'ring',               // åœ†ç¯
            SPIRAL: 'spiral',           // èºæ—‹
            WILLOW: 'willow',           // å‚æŸ³ï¼ˆä¸‹å æ•ˆæœï¼‰
            CHRYSANTHEMUM: 'chrysanthemum' // èŠèŠ±ï¼ˆå¯†é›†ç²’å­ï¼‰
            }

        // ===== ç²’å­ç³»ç»Ÿæ ¸å¿ƒç±» =====

        /**
         * çƒŸèŠ±ç²’å­ç±»
         * æ¯ä¸ªç²’å­ä»£è¡¨çˆ†ç‚¸åçš„ä¸€ä¸ªå…‰ç‚¹
         */
        class Particle {
            constructor(x, y, color) {
                this.x = x;           // Xåæ ‡
                this.y = y;           // Yåæ ‡
                this.color = color;   // é¢œè‰²

                // éšæœºè§’åº¦å’Œé€Ÿåº¦ï¼ˆå…¨æ–¹ä½çˆ†ç‚¸æ•ˆæœï¼‰
                const angle = Math.random() * Math.PI * 2;
                const speed = Math.random() * 6 + 2; // é€Ÿåº¦èŒƒå›´ 2-8

                this.vx = Math.cos(angle) * speed;  // Xè½´é€Ÿåº¦
                this.vy = Math.sin(angle) * speed;  // Yè½´é€Ÿåº¦

                this.alpha = 1;           // é€æ˜åº¦
                this.decay = Math.random() * 0.015 + 0.005; // è¡°å‡é€Ÿåº¦ï¼ˆæ§åˆ¶æ¶ˆå¤±å¿«æ…¢ï¼‰

                // ç‰©ç†å‚æ•°
                this.gravity = 0.05;      // é‡åŠ›ï¼ˆè®©ç²’å­ä¸‹å ï¼‰
                this.friction = 0.99;     // ç©ºæ°”é˜»åŠ›ï¼ˆè®©ç²’å­å‡é€Ÿï¼‰

                // é—ªçƒæ•ˆæœ
                this.blink = Math.random() > 0.5;  // æ˜¯å¦é—ªçƒ
                this.blinkSpeed = Math.random() * 0.1 + 0.05; // é—ªçƒé€Ÿåº¦
            }

            // æ›´æ–°ç²’å­çŠ¶æ€
            update() {
                // åº”ç”¨é€Ÿåº¦
                this.x += this.vx;
                this.y += this.vy;

                // åº”ç”¨ç‰©ç†æ•ˆæœ
                this.vy += this.gravity;    // é‡åŠ›è®©ç²’å­å‘ä¸‹
                this.vx *= this.friction;   // ç©ºæ°”é˜»åŠ›å‡é€Ÿ
                this.vy *= this.friction;

                // é€æ˜åº¦è¡°å‡
                this.alpha -= this.decay;

                // é—ªçƒæ•ˆæœ
                if (this.blink) {
                    this.alpha += Math.sin(Date.now() * this.blinkSpeed) * 0.1;
                    this.alpha = Math.max(0, Math.min(1, this.alpha));
                }
            }

            // ç»˜åˆ¶ç²’å­
            draw() {
                ctx.save();
                ctx.globalAlpha = this.alpha;
                ctx.fillStyle = this.color;

                // ç»˜åˆ¶åœ†å½¢ç²’å­
                ctx.beginPath();
                ctx.arc(this.x, this.y, 2, 0, Math.PI * 2);
                ctx.fill();

                // æ·»åŠ å‘å…‰æ•ˆæœ
                ctx.shadowBlur = 10;
                ctx.shadowColor = this.color;
                ctx.fill();

                ctx.restore();
            }

            // åˆ¤æ–­ç²’å­æ˜¯å¦æ­»äº¡
            isDead() {
                return this.alpha <= 0;
            }
        }

        /**
         * çƒŸèŠ±ç±»
         * åŒ…å«å‡ç©ºé˜¶æ®µå’Œçˆ†ç‚¸é˜¶æ®µ
         */
        class Firework {
            constructor(startX, startY, targetX, targetY, type = null) {
                this.x = startX;           // å½“å‰Xåæ ‡
                this.y = startY;           // å½“å‰Yåæ ‡
                this.startX = startX;      // èµ·å§‹X
                this.startY = startY;      // èµ·å§‹Y
                this.targetX = targetX;    // ç›®æ ‡Xï¼ˆçˆ†ç‚¸ä½ç½®ï¼‰
                this.targetY = targetY;    // ç›®æ ‡Yï¼ˆçˆ†ç‚¸ä½ç½®ï¼‰

                // é€‰æ‹©çƒŸèŠ±ç±»å‹
                if (type) {
                    this.type = type;
                } else if (currentFireworkType === 'all') {
                    // å…¨éƒ¨æ¨¡å¼ï¼šéšæœºé€‰æ‹©
                    const types = Object.values(FireworkTypes);
                    this.type = types[Math.floor(Math.random() * types.length)];
                } else {
                    // ä½¿ç”¨å½“å‰é€‰ä¸­çš„ç±»å‹ï¼ˆé»˜è®¤sphereï¼‰
                    this.type = currentFireworkType;
                }

                // è®¡ç®—å‡ç©ºé€Ÿåº¦ï¼ˆç¡®ä¿å‡†ç¡®åˆ°è¾¾ç›®æ ‡ç‚¹ï¼‰
                const distance = Math.sqrt(
                    Math.pow(targetX - startX, 2) + Math.pow(targetY - startY, 2)
                );
                const speed = 12;
                const angle = Math.atan2(targetY - startY, targetX - startX);

                this.vx = Math.cos(angle) * speed;
                this.vy = Math.sin(angle) * speed;

                // éšæœºé¢œè‰²ï¼ˆHSLè‰²å½©ç©ºé—´ï¼Œæ›´é²œè‰³ï¼‰
                this.hue = Math.random() * 360;
                this.color = `hsl(${this.hue}, 100%, 60%)`;

                this.trail = [];       // å°¾è¿¹æ•°ç»„
                this.trailLength = 5;  // å°¾è¿¹é•¿åº¦
                this.exploded = false; // æ˜¯å¦å·²çˆ†ç‚¸

                // ç²’å­æ•°ç»„
                this.particles = [];
                this.particleCount = 100 + Math.random() * 100; // ç²’å­æ•°é‡ 100-200
            }

            // æ›´æ–°çƒŸèŠ±çŠ¶æ€
            update() {
                // å‡ç©ºé˜¶æ®µ
                if (!this.exploded) {
                    // è®°å½•å°¾è¿¹
                    this.trail.push({ x: this.x, y: this.y });
                    if (this.trail.length > this.trailLength) {
                        this.trail.shift();
                    }

                    // æ›´æ–°ä½ç½®
                    this.x += this.vx;
                    this.y += this.vy;

                    // åº”ç”¨é‡åŠ›ï¼ˆè½»å¾®ï¼‰
                    this.vy += 0.02;

                    // åˆ¤æ–­æ˜¯å¦åˆ°è¾¾ç›®æ ‡ç‚¹ï¼ˆå¼€å§‹ä¸‹å æˆ–æ¥è¿‘ç›®æ ‡ï¼‰
                    const distanceToTarget = Math.sqrt(
                        Math.pow(this.targetX - this.x, 2) + Math.pow(this.targetY - this.y, 2)
                    );

                    if (distanceToTarget < 50 || this.vy >= 0) {
                        this.explode();
                    }
                }

                // çˆ†ç‚¸é˜¶æ®µ - æ›´æ–°æ‰€æœ‰ç²’å­
                this.particles.forEach((particle, index) => {
                    particle.update();
                    if (particle.isDead()) {
                        this.particles.splice(index, 1);
                    }
                });
            }

            // çˆ†ç‚¸æ•ˆæœ
            explode() {
                this.exploded = true;

                // æ’­æ”¾çˆ†ç‚¸éŸ³æ•ˆ
                soundManager.playExplosion();

                // æ ¹æ®ç±»å‹åˆ›å»ºä¸åŒçš„çˆ†ç‚¸æ•ˆæœ
                switch (this.type) {
                    case FireworkTypes.HEART:
                        this.createHeartExplosion();
                        break;
                    case FireworkTypes.STAR:
                        this.createStarExplosion();
                        break;
                    case FireworkTypes.RING:
                        this.createRingExplosion();
                        break;
                    case FireworkTypes.SPIRAL:
                        this.createSpiralExplosion();
                        break;
                    case FireworkTypes.WILLOW:
                        this.createWillowExplosion();
                        break;
                    case FireworkTypes.CHRYSANTHEMUM:
                        this.createChrysanthemumExplosion();
                        break;
                    default:
                        this.createSphereExplosion();
                }
            }

            // åœ†å½¢çˆ†ç‚¸ï¼ˆé»˜è®¤ï¼‰
            createSphereExplosion() {
                for (let i = 0; i < this.particleCount; i++) {
                    const hueVariation = Math.random() * 30 - 15;
                    const hue = this.hue + hueVariation;
                    const color = `hsl(${hue}, 100%, 60%)`;
                    this.particles.push(new Particle(this.x, this.y, color));
                }

                // æ·»åŠ äºŒæ¬¡çˆ†ç‚¸ï¼ˆå¤§ç²’å­ï¼‰
                for (let i = 0; i < 20; i++) {
                    const color = `hsl(${this.hue}, 100%, 80%)`;
                    const particle = new Particle(this.x, this.y, color);
                    particle.vx *= 0.5;
                    particle.vy *= 0.5;
                    particle.decay = 0.008;
                    this.particles.push(particle);
                }
            }

            // å¿ƒå½¢çˆ†ç‚¸
            createHeartExplosion() {
                const heartScale = 8; // å¿ƒå½¢å¤§å°ç¼©æ”¾
                for (let i = 0; i < 150; i++) {
                    const t = (i / 150) * Math.PI * 2;
                    // å¿ƒå½¢å‚æ•°æ–¹ç¨‹
                    const hx = 16 * Math.pow(Math.sin(t), 3);
                    const hy = -(13 * Math.cos(t) - 5 * Math.cos(2*t) - 2 * Math.cos(3*t) - Math.cos(4*t));

                    const color = `hsl(${this.hue + 20}, 100%, 60%)`; // åç²‰çº¢è‰²
                    const particle = new Particle(this.x, this.y, color);

                    particle.vx = hx * heartScale * 0.1;
                    particle.vy = hy * heartScale * 0.1;
                    particle.decay = 0.008;

                    this.particles.push(particle);
                }
            }

            // æ˜Ÿå½¢çˆ†ç‚¸
            createStarExplosion() {
                const points = 5; // äº”è§’æ˜Ÿ
                const outerRadius = 8;
                const innerRadius = 3.5; // å†…åŠå¾„è°ƒæ•´ä¸ºå¤–åŠå¾„çš„0.44å€ï¼Œå½¢æˆæ ‡å‡†äº”è§’æ˜Ÿ

                // åˆ›å»ºå¤šä¸ªç²’å­å±‚ï¼Œå½¢æˆäº”è§’æ˜Ÿå½¢çŠ¶
                for (let layer = 0; layer < 3; layer++) {
                    const particleCount = 50;
                    for (let i = 0; i < particleCount; i++) {
                        // è®¡ç®—äº”è§’æ˜Ÿçš„é¡¶ç‚¹ç´¢å¼•ï¼ˆ0-9ï¼Œå…±10ä¸ªé¡¶ç‚¹ï¼Œ5å¤–5å†…ï¼‰
                        const vertexIndex = Math.floor((i / particleCount) * points * 2);
                        const isOuter = vertexIndex % 2 === 0;

                        // è®¡ç®—è¯¥é¡¶ç‚¹çš„è§’åº¦
                        const angle = (vertexIndex * Math.PI) / points - Math.PI / 2;

                        // ä½¿ç”¨å¤–åŠå¾„æˆ–å†…åŠå¾„
                        const radius = isOuter ? outerRadius : innerRadius;

                        // æ·»åŠ ä¸€äº›éšæœºæ•£å¸ƒï¼Œè®©æ˜Ÿæ˜Ÿæ›´ä¸°æ»¡
                        const spread = Math.random() * 0.5 + 0.75;
                        const finalRadius = radius * spread;

                        const x = Math.cos(angle) * finalRadius;
                        const y = Math.sin(angle) * finalRadius;

                        const color = `hsl(${this.hue + 40}, 100%, 70%)`;
                        const particle = new Particle(this.x, this.y, color);

                        particle.vx = x;
                        particle.vy = y;
                        particle.decay = 0.01 + layer * 0.002;

                        this.particles.push(particle);
                    }
                }
            }

            // åœ†ç¯çˆ†ç‚¸
            createRingExplosion() {
                const ringCount = 3; // ä¸‰åœˆ
                for (let r = 0; r < ringCount; r++) {
                    const ringRadius = (r + 1) * 3;
                    for (let i = 0; i < 60; i++) {
                        const angle = (i / 60) * Math.PI * 2;
                        const x = Math.cos(angle) * ringRadius;
                        const y = Math.sin(angle) * ringRadius;

                        const color = `hsl(${this.hue + r * 30}, 100%, 60%)`;
                        const particle = new Particle(this.x, this.y, color);

                        particle.vx = x;
                        particle.vy = y;
                        particle.gravity = 0.02; // è¾ƒå°é‡åŠ›
                        particle.decay = 0.01;

                        this.particles.push(particle);
                    }
                }
            }

            // èºæ—‹çˆ†ç‚¸
            createSpiralExplosion() {
                for (let i = 0; i < 200; i++) {
                    const angle = i * 0.3;
                    const radius = i * 0.08;

                    const x = Math.cos(angle) * radius;
                    const y = Math.sin(angle) * radius;

                    const color = `hsl(${this.hue + i * 2}, 100%, 60%)`;
                    const particle = new Particle(this.x, this.y, color);

                    particle.vx = x;
                    particle.vy = y;
                    particle.decay = 0.006;

                    this.particles.push(particle);
                }
            }

            // å‚æŸ³çˆ†ç‚¸ï¼ˆä¸‹å æ•ˆæœï¼‰
            createWillowExplosion() {
                const particleCount = 200; // å¢åŠ ç²’å­æ•°é‡ï¼Œæ›´å¤§æœµ

                for (let i = 0; i < particleCount; i++) {
                    const angle = Math.random() * Math.PI * 2;
                    const speed = Math.random() * 6 + 3; // é€Ÿåº¦èŒƒå›´å¢å¤§

                    const color = `hsl(${this.hue}, 80%, 70%)`;
                    const particle = new Particle(this.x, this.y, color);

                    particle.vx = Math.cos(angle) * speed * 0.5;
                    particle.vy = Math.sin(angle) * speed * 0.3; // Yè½´é€Ÿåº¦è¾ƒå°
                    particle.gravity = 0.12; // é‡åŠ›æ›´å¤§ï¼Œä¸‹å æ›´æ˜æ˜¾
                    particle.friction = 0.98;
                    particle.decay = 0.004; // å­˜æ´»æ—¶é—´æ›´é•¿ï¼Œè®©å‚æŸ³é£˜å¾—æ›´ä¹…

                    this.particles.push(particle);
                }
            }

            // èŠèŠ±çˆ†ç‚¸ï¼ˆå¯†é›†ç²’å­ï¼‰
            createChrysanthemumExplosion() {
                const particleCount = 250; // æ›´å¤šç²’å­
                for (let i = 0; i < particleCount; i++) {
                    const angle = Math.random() * Math.PI * 2;
                    const speed = Math.random() * 7 + 3;

                    const hueVariation = Math.random() * 20 - 10;
                    const color = `hsl(${this.hue + hueVariation}, 100%, 65%)`;
                    const particle = new Particle(this.x, this.y, color);

                    particle.vx = Math.cos(angle) * speed;
                    particle.vy = Math.sin(angle) * speed;
                    particle.gravity = 0.03;
                    particle.decay = 0.004; // å­˜æ´»æ—¶é—´å¾ˆé•¿

                    this.particles.push(particle);
                }
            }

            // ç»˜åˆ¶çƒŸèŠ±
            draw() {
                // ç»˜åˆ¶å‡ç©ºé˜¶æ®µçš„ç«ç®­å’Œå°¾è¿¹
                if (!this.exploded) {
                    // ç»˜åˆ¶å°¾è¿¹
                    this.trail.forEach((point, index) => {
                        const alpha = index / this.trail.length;
                        ctx.save();
                        ctx.globalAlpha = alpha * 0.5;
                        ctx.fillStyle = this.color;
                        ctx.beginPath();
                        ctx.arc(point.x, point.y, 2, 0, Math.PI * 2);
                        ctx.fill();
                        ctx.restore();
                    });

                    // ç»˜åˆ¶ç«ç®­å¤´
                    ctx.save();
                    ctx.fillStyle = this.color;
                    ctx.shadowBlur = 15;
                    ctx.shadowColor = this.color;
                    ctx.beginPath();
                    ctx.arc(this.x, this.y, 3, 0, Math.PI * 2);
                    ctx.fill();
                    ctx.restore();
                }

                // ç»˜åˆ¶çˆ†ç‚¸ç²’å­
                this.particles.forEach(particle => {
                    particle.draw();
                });
            }

            // åˆ¤æ–­çƒŸèŠ±æ˜¯å¦å®Œå…¨æ¶ˆå¤±
            isDead() {
                return this.exploded && this.particles.length === 0;
            }
        }

        // ===== ä¸»ç¨‹åºé€»è¾‘ =====

        let fireworks = []; // çƒŸèŠ±æ•°ç»„

        /**
         * åˆ›å»ºçƒŸèŠ±
         * @param {number} x - ç›®æ ‡Xåæ ‡
         * @param {number} y - ç›®æ ‡Yåæ ‡
         */
        function createFirework(x, y) {
            // ä»åº•éƒ¨éšæœºä½ç½®å‘å°„
            const startX = Math.random() * canvasWidth;
            const startY = canvasHeight;

            fireworks.push(new Firework(startX, startY, x, y));
        }

        /**
         * è‡ªåŠ¨ç‡ƒæ”¾çƒŸèŠ±
         */
        function autoLaunch() {
            // éšæœºä½ç½®ï¼ˆä¸ŠåŠéƒ¨åˆ†ï¼‰
            const x = Math.random() * canvasWidth;
            const y = Math.random() * (canvasHeight * 0.6) + (canvasHeight * 0.1);

            createFirework(x, y);
        }

        // åŠ¨ç”»å¾ªç¯
        function animate() {
            // ä½¿ç”¨åŠé€æ˜èƒŒæ™¯å®ç°æ‹–å°¾æ•ˆæœ
            ctx.fillStyle = 'rgba(10, 10, 26, 0.2)';
            ctx.fillRect(0, 0, canvasWidth, canvasHeight);

            // æ›´æ–°å’Œç»˜åˆ¶æ‰€æœ‰çƒŸèŠ±
            fireworks.forEach((firework, index) => {
                firework.update();
                firework.draw();

                // ç§»é™¤æ¶ˆå¤±çš„çƒŸèŠ±
                if (firework.isDead()) {
                    fireworks.splice(index, 1);
                }
            });

            // ç»˜åˆ¶æ³¢çº¹æ•ˆæœ
            ripples.forEach((ripple, index) => {
                ctx.save();
                ctx.beginPath();
                ctx.arc(ripple.x, ripple.y, ripple.radius, 0, Math.PI * 2);
                ctx.strokeStyle = `rgba(255, 255, 255, ${ripple.alpha})`;
                ctx.lineWidth = 2;
                ctx.stroke();
                ctx.restore();

                // æ›´æ–°æ³¢çº¹çŠ¶æ€
                ripple.radius += 3;
                ripple.alpha -= 0.05;

                // ç§»é™¤æ¶ˆå¤±çš„æ³¢çº¹
                if (ripple.alpha <= 0) {
                    ripples.splice(index, 1);
                }
            });

            requestAnimationFrame(animate);
        }

        // ===== äº¤äº’äº‹ä»¶ =====

        // ä¸‰è¿å‡»æ£€æµ‹å˜é‡
        let clickCount = 0;
        let clickTimer = null;
        const tripleClickDelay = 500; // 500mså†…ç‚¹å‡»3æ¬¡

        // ç»Ÿä¸€å¤„ç†ç‚¹å‡»å’Œè§¦æ‘¸äº‹ä»¶
        function handleClick(x, y) {
            clickCount++;

            // æ¸…é™¤ä¹‹å‰çš„å®šæ—¶å™¨
            if (clickTimer) {
                clearTimeout(clickTimer);
            }

            // è®¾ç½®æ–°çš„å®šæ—¶å™¨
            clickTimer = setTimeout(() => {
                // è¶…æ—¶åé‡ç½®ç‚¹å‡»è®¡æ•°
                clickCount = 0;
            }, tripleClickDelay);

            // æ£€æµ‹ä¸‰è¿å‡»
            if (clickCount === 3) {
                // ä¸‰è¿å‡» - åˆ‡æ¢å…¨å±
                toggleFullscreen();
                clickCount = 0;
                if (clickTimer) {
                    clearTimeout(clickTimer);
                    clickTimer = null;
                }
                return;
            }

            // å•å‡»/åŒå‡» - å‘å°„çƒŸèŠ±
            createFirework(x, y);
            createClickEffect(x, y);
        }

        // é¼ æ ‡ç‚¹å‡»äº‹ä»¶
        canvas.addEventListener('click', (e) => {
            handleClick(e.clientX, e.clientY);
        });

        // è§¦æ‘¸äº‹ä»¶ï¼ˆç§»åŠ¨ç«¯ï¼‰
        canvas.addEventListener('touchstart', (e) => {
            e.preventDefault();
            const touch = e.touches[0];
            handleClick(touch.clientX, touch.clientY);
        });

        /**
         * ç‚¹å‡»åé¦ˆæ•ˆæœ
         * åœ¨ç‚¹å‡»ä½ç½®ç«‹å³åˆ›å»ºä¸€ä¸ªå°çˆ†ç‚¸ï¼Œç»™ç”¨æˆ·å³æ—¶åé¦ˆ
         */
        function createClickEffect(x, y) {
            // åˆ›å»ºä¸€ä¸ªç«‹å³çˆ†ç‚¸çš„å°å‹çƒŸèŠ±
            const clickFirework = new Firework(x, y, x, y);
            clickFirework.explode(); // ç«‹å³çˆ†ç‚¸

            // æ·»åŠ ç‰¹æ®Šçš„ç‚¹å‡»åé¦ˆç²’å­ï¼ˆæ›´äº®ã€æ›´å°ï¼‰
            for (let i = 0; i < 30; i++) {
                const hue = Math.random() * 60 + 30; // é‡‘é»„è‰²ç³»
                const color = `hsl(${hue}, 100%, 70%)`;
                const particle = new Particle(x, y, color);

                // é€Ÿåº¦æ›´å¿«ï¼Œæ‰©æ•£æ›´å°
                const angle = Math.random() * Math.PI * 2;
                const speed = Math.random() * 3 + 1;
                particle.vx = Math.cos(angle) * speed;
                particle.vy = Math.sin(angle) * speed;
                particle.decay = 0.03; // æ¶ˆå¤±å¾—æ›´å¿«

                clickFirework.particles.push(particle);
            }

            fireworks.push(clickFirework);

            // æ·»åŠ ç‚¹å‡»æ³¢çº¹æ•ˆæœ
            createRipple(x, y);
        }

        /**
         * ç‚¹å‡»æ³¢çº¹æ•ˆæœ
         */
        const ripples = [];
        function createRipple(x, y) {
            ripples.push({
                x: x,
                y: y,
                radius: 0,
                alpha: 1
            });
        }

        // è‡ªåŠ¨ç‡ƒæ”¾å®šæ—¶å™¨
        let autoLaunchInterval = null;
        let isAutoLaunching = false;

        function startAutoLaunch() {
            if (isAutoLaunching) return;
            isAutoLaunching = true;

            autoLaunchInterval = setInterval(() => {
                // æ£€æŸ¥é¡µé¢æ˜¯å¦å¯è§
                if (!document.hidden) {
                    // éšæœºé—´éš”å‘å°„ï¼Œå¢åŠ è‡ªç„¶æ„Ÿ
                    if (Math.random() > 0.3) {
                        autoLaunch();
                    }
                }
            }, 500);
        }

        function stopAutoLaunch() {
            if (autoLaunchInterval) {
                clearInterval(autoLaunchInterval);
                autoLaunchInterval = null;
            }
            isAutoLaunching = false;
        }

        // ç›‘å¬é¡µé¢å¯è§æ€§å˜åŒ–
        document.addEventListener('visibilitychange', () => {
            if (document.hidden) {
                // é¡µé¢éšè—æ—¶åœæ­¢è‡ªåŠ¨å‘å°„
                stopAutoLaunch();
            } else {
                // é¡µé¢æ˜¾ç¤ºæ—¶æ¢å¤è‡ªåŠ¨å‘å°„
                startAutoLaunch();
            }
        });

        // å¯åŠ¨è‡ªåŠ¨å‘å°„
        startAutoLaunch();

        // åˆå§‹å‘å°„å‡ å‘çƒŸèŠ±
        setTimeout(() => autoLaunch(), 500);
        setTimeout(() => autoLaunch(), 1000);
        setTimeout(() => autoLaunch(), 1500);

        // å¯åŠ¨åŠ¨ç”»
        animate();

        // ===== å…¨å±åŠŸèƒ½ =====

        // åˆ‡æ¢å…¨å±å‡½æ•°ï¼ˆæå‰å®šä¹‰ï¼Œä¾›åŒå‡»ä½¿ç”¨ï¼‰
        function toggleFullscreen() {
            if (!document.fullscreenElement) {
                document.documentElement.requestFullscreen().catch(err => {
                    console.log(`å…¨å±å¤±è´¥: ${err.message}`);
                });
            } else {
                document.exitFullscreen();
            }
        }

        // å¿«æ·é”®å…¨å±ï¼ˆç”µè„‘ç«¯ï¼‰
        document.addEventListener('keydown', (e) => {
            // Ctrl+M æˆ– Cmd+M (Mac) åˆ‡æ¢å…¨å±
            if ((e.ctrlKey || e.metaKey) && e.key === 'm') {
                e.preventDefault(); // é˜»æ­¢é»˜è®¤è¡Œä¸º
                toggleFullscreen();
            }
        });

        // ç›‘å¬å…¨å±çŠ¶æ€å˜åŒ–ï¼Œæ›´æ–°æç¤ºæ–‡å­—
        document.addEventListener('fullscreenchange', () => {
            const hint = document.querySelector('.hint');
            if (document.fullscreenElement) {
                hint.textContent = 'âœ¨ å•å‡»å‘å°„ Â· ä¸‰è¿å‡»æˆ–ESCé€€å‡ºå…¨å± âœ¨';
            } else {
                hint.textContent = 'âœ¨ å•å‡»å‘å°„çƒŸèŠ± Â· ä¸‰è¿å‡»åˆ‡æ¢å…¨å± âœ¨';
            }
        });

        /**
         * æ€§èƒ½ä¼˜åŒ–æç¤ºï¼š
         * - ä½¿ç”¨ requestAnimationFrame ä¿è¯æµç•…åŠ¨ç”»
         * - åŠæ—¶æ¸…ç†æ¶ˆå¤±çš„ç²’å­å’ŒçƒŸèŠ±
         * - æ§åˆ¶åŒå±çƒŸèŠ±æ•°é‡ï¼ˆè‡ªåŠ¨ç‡ƒæ”¾é¢‘ç‡é€‚ä¸­ï¼‰
         * - ä½¿ç”¨å¯¹è±¡æ± å¯è¿›ä¸€æ­¥ä¼˜åŒ–ï¼ˆå½“å‰ç‰ˆæœ¬æš‚ä¸éœ€è¦ï¼‰
         */
    </script>
</body>
</html>